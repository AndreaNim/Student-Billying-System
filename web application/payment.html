<!DOCTYPE html>
<html lang="en">
<head>
  <title>Billying System</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>
  
<nav>
  <ul >
    <li><a href="#home">Home</a></li>
    <li><a href="login.html">Logout</a></li>
    <li id="useremail"> </li>
  </ul>
  
  
</nav>
<div class="container">
  <h2>Make Payments</h2>
  <form action="/action_page.php" id="paymentform" >
    <div class="form-group">
      <label for="tuitionPlanId">Tuition Plan Id:</label>
      <input type="tuitionPlanId" class="form-control" id="tuitionPlanId" placeholder="Enter tuition Plan Id" name="tuitionPlanId">
    </div>
    <div class="form-group">
      <label for="payment">Payment Amount:</label>
      <input type="number" lass="form-control" min="0.01" step="0.01"  id="payment" placeholder="Enter payment amount" name="payment">
    </div>
    <div class="checkbox">
      <label><input type="checkbox" name="remember"> Remember me</label>
    </div>
    <button type="submit" class="btn btn-default" style="background-color:#4CAF50;">Submit</button>
    <div class="form-group">
      <br>
      <h3 id="message"></h3>
    </div>
  </form>
</div>
<style>
  ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
  
  li {
    display: inline;
  }
  </style>
  
<script>
    const paymentform=document.getElementById("paymentform");
    paymentform.addEventListener("submit",(event)=>{
      const tuitionPlanId = document.getElementById("tuitionPlanId").value;
      var today = new Date();
      const date=today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
      const paymentAmount=document.getElementById("payment").value;
      const jwt=localStorage.getItem("token");
      console.log(tuitionPlanId,date,paymentAmount)
      event.preventDefault();
        fetch("http://localhost:8080/payments/Addpayment",{
        method:"POST",
        headers:{
          'Authorization': 'Bearer'+""+jwt,
          'Content-Type':'application/json'
        },
        body:JSON.stringify({ 
          "paymentDatetime":date,
          "payment":paymentAmount,
          "studentId":1,
          "tuitionPlanId":tuitionPlanId
        })
        }).then(res => {
          console.log(res)
          if(!res.ok){
            return Promise.reject(res.json())
          }
            return res.json();
        })
        .then (data => {
           document.getElementById("message").innerHTML = 'success';
           localStorage.setItem("token",data.token);
           window.location.replace("bill.html")
          }).catch((error)=>{
            if(error.message){
              document.getElementById("message").innerHTML = error.message;
            }else{
              error.then(resp =>{
              console.log("error")
              console.log(resp.message)
              document.getElementById("message").innerHTML = resp.message;
            })
            }

          })
    });
</script>
</body>
</html>

